#
# BUILD COMMAND: sudo DOCKER_BUILDKIT=1 docker build -t usdotfhwastoldev/carla-voices:pilot2-event2-0.0.3 . --progress=plain -f carla-voices_Dockerfile
#

FROM carlasim/carla:0.9.10

LABEL version="0.0.3"
LABEL description="VOICES Docker image for CARLA including event maps"

SHELL ["/bin/bash", "-ec"]

ARG DEBIAN_FRONTEND="noninteractive" 
ARG TZ="America/New_York"

RUN --mount=type=bind,target=./Import,readonly,source=../lib/MAPS \
    sed -i 's/--keep-newer-files/--skip-old-files/' ImportAssets.sh && \
    ./ImportAssets.sh 

COPY ../lib/COPY/start_scripts /home/carla/start_scripts
COPY ../lib/COPY/.voices_site_config_docker /home/carla/.voices_site_config_docker
COPY ../lib/COPY/.voices_scenario_config_docker /home/carla/.voices_scenario_config_docker
COPY ../lib/COPY/VOICES_Limited_License_V0.2.pdf /home/carla/VOICES_Limited_License_V0.2.pdf

USER root

RUN chmod a+x -R /home/carla/start_scripts/*

RUN echo 'source /home/carla/start_scripts/setup-carla-docker.sh' >> /home/carla/.bashrc

USER carla

CMD ["/bin/bash","-l","-c","/home/carla/start_scripts/startup-carla.sh"]
